<link href="//cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css" rel="stylesheet"/>
<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>
<link href="/css/style.css" rel="stylesheet" type="text/css">

<!--


    add to printer class

    margin-left: 43%;
    transform: translateX(-50%);
    margin-right: -16%;


    -->
<div class="">
    {{#each data}}
        {{#if this.color}}
            {{#if this.cartridge.critical}}
            <div class="printer printer-{{this.floor}} container-critical-unit">
            {{else}}
            <div class="printer printer-{{this.floor}}">
            {{/if}}

            {{#ifEquals this.printer_ping.alive false}}
                <div style="color: red;text-decoration: line-through;" class="pr-12k title">
                    <a style="color: red" name="title" href="//{{this.ip}}/" target="_blank"
                       rel="noopener">{{this.name}}<br>{{this.ip}}</a>
                </div>
            {{else}}
                <div class="pr-12k title">
                    <a name="title" href="//{{this.ip}}/" target="_blank" rel="noopener">{{this.name}}<br>{{this.ip}}
                    </a>
                </div>
            {{/ifEquals}}

            <div>
                <form class="input-inline" action="/floor/{{this.floor}}k/{{this.name}}">
                    <button class="button-special-style {{this.name}}" href="/{{this.floor}}k/{{this.name}}">Asukoht
                    </button>
                </form>
                <form class="input-inline" action="/storage/{{this.name}}">
                    <button class="button-special-style">Laoseis</button>
                    <input type="submit" hidden name="selected-storage-black" value="{{this.cartridge.black.name}}">
                </form>
            </div>

            <section>
                <article>
                    <div class="chart">

                        <form method="post" action="/cartridge/storage">
                            <div class="quantity">
                                <p class="quantity-cartridge-info">{{this.cartridge.black.name}} Storage: </p>
                                <input class="cartridge-storage" name="inc_storage_count"
                                       aria-label="inc-storage-number" type="number" min="1" step="1"
                                       value="{{this.cartridge.black.supply.storage}}">
                                <div class="quantity-nav">
                                    <div class="quantity-button quantity-up">+</div>
                                    <div class="quantity-button quantity-down">-</div>
                                </div>
                            </div>
                            <input type="hidden" class="printer-title" name="inc_storage_title" value="{{this.name}}">
                            <input type="hidden" class="cartridge-name" name="inc_storage_name"
                                   value="{{this.cartridge.black.name}}">
                            <input type="hidden" class="cartridge-name" name="update_route" value="/">
                        </form>
                        <div class="progress" style="height: 50px;">
                            <div class="progress-bar bg-dark"
                                 style="width:{{this.cartridge.black.value}}%; height: 50px;">{{this.cartridge.black.value}}
                                %
                            </div>
                        </div>
                        <div>
                        </div>
                    </div>
                </article>
            </section>

            <section>
                <article>
                    <div class="chart">

                        <form method="post" action="/cartridge/storage">
                            <div class="quantity">
                                <p class="quantity-cartridge-info">{{this.cartridge.cyan.name}} Storage: </p>
                                <input class="cartridge-storage" name="inc_storage_count" type="number" min="1" step="1"
                                       value="{{this.cartridge.cyan.supply.storage}}">
                                <div class="quantity-nav">
                                    <div class="quantity-button quantity-up">+</div>
                                    <div class="quantity-button quantity-down">-</div>
                                </div>
                            </div>
                            <input type="hidden" class="printer-title" name="inc_storage_title" value="{{this.name}}">
                            <input type="hidden" class="cartridge-name" name="inc_storage_name"
                                   value="{{this.cartridge.cyan.name}}">
                            <input type="hidden" class="cartridge-name" name="update_route" value="/">
                        </form>
                        <div class="progress" style="height: 50px;">
                            <div class="progress-bar cyan-bar-map"
                                 style="width:{{this.cartridge.cyan.value}}%; height: 50px;">{{this.cartridge.cyan.value}}
                                %
                            </div>
                        </div>
                    </div>
                </article>
            </section>
            <section>
                <article>
                    <div class="chart">

                        <form method="post" action="/cartridge/storage">
                            <div class="quantity">
                                <p class="quantity-cartridge-info">{{this.cartridge.magenta.name}} Storage: </p>
                                <input class="cartridge-storage" name="inc_storage_count" type="number" min="0" step="1"
                                       value="{{this.cartridge.magenta.supply.storage}}">
                                <div class="quantity-nav">
                                    <div class="quantity-button quantity-up">+</div>
                                    <div class="quantity-button quantity-down">-</div>
                                </div>
                            </div>
                            <input type="hidden" class="printer-title" name="inc_storage_title" value="{{this.name}}">
                            <input type="hidden" class="cartridge-name" name="inc_storage_name"
                                   value="{{this.cartridge.magenta.name}}">
                            <input type="hidden" class="cartridge-name" name="update_route" value="/">
                        </form>

                        <div class="progress" style="height: 50px;">
                            <div class="progress-bar magenta-bar-map"
                                 style="width:{{this.cartridge.magenta.value}}%; height: 50px;">{{this.cartridge.magenta.value}}
                                %
                            </div>
                        </div>
                    </div>
                </article>
            </section>
            <section>
                <article>
                    <div class="chart">
                        <form method="post" action="/cartridge/storage">
                            <div class="quantity">
                                <p class="quantity-cartridge-info">{{this.cartridge.yellow.name}} Storage: </p>
                                <input class="cartridge-storage" name="inc_storage_count" type="number" min="1" step="1"
                                       value="{{this.cartridge.yellow.supply.storage}}">
                                <div class="quantity-nav">
                                    <div class="quantity-button quantity-up">+</div>
                                    <div class="quantity-button quantity-down">-</div>
                                </div>
                            </div>
                            <input type="hidden" class="printer-title" name="inc_storage_title" value="{{this.name}}">
                            <input type="hidden" class="cartridge-name" name="inc_storage_name"
                                   value="{{this.cartridge.yellow.name}}">
                            <input type="hidden" class="cartridge-name" name="update_route" value="/">
                        </form>

                        <div class="progress" style="height: 50px;">
                            <div class="progress-bar yellow-bar-map"
                                 style="width:{{this.cartridge.yellow.value}}%; height: 50px;">{{this.cartridge.yellow.value}}
                                %
                            </div>
                        </div>
                    </div>
                </article>
            </section>
        </div>

        {{else}}
            {{#if this.cartridge.critical}}
            <div class="printer printer-{{this.floor}} container-critical-unit">
            {{else}}
            <div class="printer printer-{{this.floor}}">
            {{/if}}
            {{#ifEquals this.printer_ping.alive false}}
                <div style="color: red;text-decoration: line-through;" class="pr-12k title">
                    <a style="color: red" name="title" href="//{{this.ip}}/" target="_blank"
                       rel="noopener">{{this.name}}<br>{{this.ip}}</a>
                </div>
            {{else}}
                <div class="pr-12k title">
                    <a name="title" href="//{{this.ip}}/" target="_blank" rel="noopener">{{this.name}}<br>{{this.ip}}
                    </a>
                </div>
            {{/ifEquals}}

            <div>
                <form class="input-inline" action="/floor/{{this.floor}}k/{{this.name}}">
                    <button class="button-special-style {{this.name}}" href="/floor/{{this.floor}}k/{{this.name}}">
                        Asukoht
                    </button>
                </form>
                <form class="input-inline" action="/storage/{{this.name}}">
                    <button class="button-special-style">Laoseis</button>
                    <input type="submit" hidden name="selected-storage-black" value="{{this.cartridge.black.name}}">
                </form>
            </div>

            <section>
                <article>
                    <div class="chart">
                        <form method="post" action="/cartridge/storage">
                            <div class="quantity">
                                <p class="quantity-cartridge-info">{{this.cartridge.black.name}} Storage: </p>
                                <input class="cartridge-storage" name="inc_storage_count" type="number" min="0" step="1"
                                       value="{{this.cartridge.black.supply.storage}}">
                                <div class="quantity-nav">
                                    <div class="quantity-button quantity-up">+</div>
                                    <div class="quantity-button quantity-down">-</div>
                                </div>
                            </div>
                            <input type="hidden" class="printer-title" name="inc_storage_title" value="{{this.name}}">
                            <input type="hidden" class="cartridge-name" name="inc_storage_name"
                                   value="{{this.cartridge.black.name}}">
                            <input type="hidden" class="cartridge-name" name="update_route" value="/">
                        </form>

                        <div class="progress" style="height:50px;">
                            <div class="progress-bar black-bar"
                                 style="width:{{this.cartridge.black.value}}%; height: 50px;"><p
                                    style="line-height: 3.5">{{this.cartridge.black.value}}%</p></div>
                        </div>
                    </div>
                </article>
            </section>
        </div>
        {{/if}}
    </div>
    {{/each}}








    {{#if this.critical}}
    <div class="statistics-printer-container container-critical-unit">
    {{else}}
    <div class="statistics-printer-container">
    {{/if}}
    <div class="chart-info" style="display:inline-block"></div>
</div>
</div>















    <script>
        let chart_{{@index}} = c3.generate({
            bindto: '.chart-info',
            size: {
                height: 400,
                width: 800
            },
            data: {
                type: 'spline',
                json: [
                    {{#each chart}}
                        {{#each this}}
                            {{#compare this.date '!==' undefined}}
                                {{#if ../this.color}}
                                    {
                                        black: {{this.black}},
                                        cyan:{{this.cyan}},
                                        yellow:{{this.yellow}},
                                        magenta:{{this.magenta}},
                                        date: '{{this.date}}'
                                    },
                                {{else}}
                                    {black: {{this.black}}, date: '{{this.date}}'},
                                {{/if}}
                            {{/compare}}
                        {{/each}}
                    {{/each}}
                ],
                keys: {
                    x: 'date', // it's possible to specify 'x' when category axis
                    {{#if data.color}}
                        value: ['black', 'cyan', 'yellow', 'magenta'],
                    {{else}}
                        value: ['black'],
                    {{/if}}
                }
            },
            axis: {
                x: {
                    type: 'category',
                },
                y: {
                    min: 0,
                    max: 100,
                    padding: {top: 0, bottom: 0}
                }
            },
            grid: {
                y: {
                    lines: [
                        {value: 10, class: 'gridRed', text: '10% piir'},
                    ]
                },
                x: {
                    lines: [
                        {{#each chart.xgrid}}
                            {value: '{{this.value}}', class: 'blue', text: '{{this.text}}'},
                        {{/each}}
                    ]
                }
            },
            point: {
                show: false
            },
            /* tooltip: {
                 format: {
                     title: function (d) { return 'Data ' + d; },
                     value: function (value, ratio, id) {
                         var format = id === 'black' ? d3.format('$$') : d3.format('$$$');
                         return format(value);
                     }

    //            value: d3.format(',') // apply this format to both y and y2
                 }
             },*/
            color: {
                pattern: ['#000000', '#00e8e2', '#f8ff00', '#ff00fd']
            }
        });
    </script>
